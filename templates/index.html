<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´‘ê³  ì†Œê°œì„œ PPT ìë™ ìƒì„±ê¸°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .project { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; }
    .thumbnail { height: 100px; margin: 5px; cursor: pointer; border: 2px solid transparent; }
    .thumbnail.selected { border-color: #007BFF; }
  </style>
</head>
<body>

  <h2>ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
  <input type="file" id="imageUpload" multiple accept="image/*">
  <div id="imagePreview"></div>

  <h2>í”„ë¡œì íŠ¸ ìƒì„±</h2>
  <button onclick="addProject()">+ í”„ë¡œì íŠ¸ ì¶”ê°€</button>
  <div id="projects"></div>

  <button onclick="submitData()">ğŸ“¤ PPT ìƒì„±í•˜ê¸°</button>

  <script>
    let images = [];
    let projects = [];

    document.getElementById('imageUpload').addEventListener('change', (e) => {
      images = Array.from(e.target.files);
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = '';
      images.forEach((file, i) => {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        img.classList.add('thumbnail');
        img.dataset.index = i;
        preview.appendChild(img);
      });
    });
    
function addProject() {
  if (projects.length >= 10) return alert('ìµœëŒ€ 10ê°œ í”„ë¡œì íŠ¸ê¹Œì§€ ìƒì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.');

  const container = document.createElement('div');
  container.classList.add('project');
  const index = projects.length;

  container.innerHTML = `
    <h3>í”„ë¡œì íŠ¸ ${index + 1}</h3>
    <input type="text" placeholder="ê´‘ê³  ìƒí’ˆëª… ì…ë ¥" class="productName">
    <div class="imageGrid"></div>
  `;

  document.getElementById('projects').appendChild(container);
  projects.push({ images: [], name: '' });

  const imageGrid = container.querySelector('.imageGrid');

  images.forEach((file, i) => {
    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.classList.add('thumbnail');
    img.dataset.index = i;

    img.addEventListener('click', () => {
      img.classList.toggle('selected');
    });

    imageGrid.appendChild(img);
  });
}

    async function submitData() {
      const result = [];
      const projectDivs = document.querySelectorAll('.project');
      projectDivs.forEach((proj) => {
        const name = proj.querySelector('.productName').value;
        const selected = Array.from(proj.querySelectorAll('.thumbnail.selected'))
          .map(img => images[img.dataset.index].name);
        if (selected.length > 0 && name) {
          result.push([...selected, name]);
        }
      });

      if (result.length === 0) {
        alert("ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•´ì£¼ì„¸ìš”!");
        return;
      }

      // 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ
      const formData = new FormData();
      images.forEach(file => formData.append('images', file));

      await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      // 2. PPT ìƒì„± ìš”ì²­
      await fetch('/generate_ppt', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ projects: result })
      })
      .then(res => res.blob())
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ê´‘ê³ ì†Œê°œì„œ.pptx';
        document.body.appendChild(a);
        a.click();
        a.remove();
      });
    }
  </script>

</body>
</html>
